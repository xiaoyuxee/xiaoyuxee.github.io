<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="假装是个程序员"><title>Java中的NIO | 子善</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/3.0.3/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Java中的NIO</h1><a id="logo" href="/.">子善</a><p class="description">假装是个程序员</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Java中的NIO</h1><div class="post-meta">Mar 11, 2016<span> | </span><span class="category"><a href="/categories/Java-Core/">Java-Core</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2016/03/11/nio-in-java/" href="/2016/03/11/nio-in-java/#disqus_thread" class="disqus-comment-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#u8DEF_u5F84_uFF08Path_uFF09"><span class="toc-number">1.</span> <span class="toc-text">路径（Path）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u4EC0_u4E48_u662F_u8DEF_u5F84"><span class="toc-number">1.1.</span> <span class="toc-text">什么是路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u8DEF_u5F84_u7C7B_u578B"><span class="toc-number">1.2.</span> <span class="toc-text">路径类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Path_u7684_u4E3B_u8981_u65B9_u6CD5"><span class="toc-number">1.3.</span> <span class="toc-text">Path的主要方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#u521B_u5EFA_u8DEF_u5F84"><span class="toc-number">1.3.1.</span> <span class="toc-text">创建路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#u83B7_u53D6_u8DEF_u5F84_u4FE1_u606F"><span class="toc-number">1.3.2.</span> <span class="toc-text">获取路径信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#u89C4_u683C_u5316_u8DEF_u5F84"><span class="toc-number">1.3.3.</span> <span class="toc-text">规格化路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#u8DEF_u5F84_u8F6C_u6362"><span class="toc-number">1.3.4.</span> <span class="toc-text">路径转换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#u89E3_u6790_u76F8_u5BF9_u8DEF_u5F84"><span class="toc-number">1.3.5.</span> <span class="toc-text">解析相对路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#u521B_u5EFA_u76F8_u5BF9_u8DEF_u5F84"><span class="toc-number">1.3.6.</span> <span class="toc-text">创建相对路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#u8DEF_u5F84_u6BD4_u8F83"><span class="toc-number">1.3.7.</span> <span class="toc-text">路径比较</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#u904D_u5386_u8DEF_u5F84_u4E2D_u7684_u5143_u7D20"><span class="toc-number">1.3.8.</span> <span class="toc-text">遍历路径中的元素</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Files_u57FA_u672C_u64CD_u4F5C"><span class="toc-number">2.</span> <span class="toc-text">Files基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u68C0_u67E5_u64CD_u4F5C"><span class="toc-number">2.1.</span> <span class="toc-text">检查操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#u6587_u4EF6_u5B58_u5728_u6027_u5224_u65AD"><span class="toc-number">2.1.1.</span> <span class="toc-text">文件存在性判断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#u6587_u4EF6_u8BBF_u95EE_u6743_u9650_u5224_u65AD"><span class="toc-number">2.1.2.</span> <span class="toc-text">文件访问权限判断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#u8DEF_u5F84_u5B9A_u4F4D_u662F_u5426_u540C_u4E00_u6587_u4EF6"><span class="toc-number">2.1.3.</span> <span class="toc-text">路径定位是否同一文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u5220_u9664_u3001_u79FB_u52A8_u3001_u590D_u5236"><span class="toc-number">2.2.</span> <span class="toc-text">删除、移动、复制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#u5220_u9664"><span class="toc-number">2.2.1.</span> <span class="toc-text">删除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#u590D_u5236"><span class="toc-number">2.2.2.</span> <span class="toc-text">复制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#u79FB_u52A8/_u91CD_u547D_u540D"><span class="toc-number">2.2.3.</span> <span class="toc-text">移动/重命名</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u6587_u4EF6_u5143_u6570_u636E_uFF08_u6587_u4EF6_u5C5E_u6027_uFF09"><span class="toc-number">3.</span> <span class="toc-text">文件元数据（文件属性）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u57FA_u672C_u6587_u4EF6_u5C5E_u6027"><span class="toc-number">3.1.</span> <span class="toc-text">基本文件属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u8BBE_u7F6E_u6587_u4EF6_u65F6_u95F4_u6233"><span class="toc-number">3.2.</span> <span class="toc-text">设置文件时间戳</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u5176_u4ED6_u5C5E_u6027_u83B7_u53D6"><span class="toc-number">3.3.</span> <span class="toc-text">其他属性获取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u5176_u4ED6_u5C5E_u6027_u8BBE_u7F6E"><span class="toc-number">3.4.</span> <span class="toc-text">其他属性设置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u6587_u4EF6_u7684_u8BFB_u53D6_u3001_u4FEE_u6539_u4E0E_u521B_u5EFA"><span class="toc-number">4.</span> <span class="toc-text">文件的读取、修改与创建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenOption_u53C2_u6570"><span class="toc-number">4.1.</span> <span class="toc-text">OpenOption参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u5E38_u7528_u64CD_u4F5C"><span class="toc-number">4.2.</span> <span class="toc-text">常用操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u9762_u5411_u5177_u6709_u7F13_u5B58_u529F_u80FDio_u7684_u64CD_u4F5C"><span class="toc-number">4.3.</span> <span class="toc-text">面向具有缓存功能io的操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u9762_u5411_u4E0D_u5177_u6709_u7F13_u5B58_u529F_u80FDio_u7684_u64CD_u4F5C"><span class="toc-number">4.4.</span> <span class="toc-text">面向不具有缓存功能io的操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u9762_u5411_u7BA1_u9053_u7684_u64CD_u4F5C"><span class="toc-number">4.5.</span> <span class="toc-text">面向管道的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#u8BFB_u53D6_u7F13_u5B58_u5B57_u8282"><span class="toc-number">4.5.1.</span> <span class="toc-text">读取缓存字节</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#u5199_u5165_u7F13_u5B58_u5B57_u8282"><span class="toc-number">4.5.2.</span> <span class="toc-text">写入缓存字节</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u521B_u5EFA_u6587_u4EF6"><span class="toc-number">4.6.</span> <span class="toc-text">创建文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#u521B_u5EFA_u4E34_u65F6_u6587_u4EF6"><span class="toc-number">4.6.1.</span> <span class="toc-text">创建临时文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u6587_u4EF6_u76EE_u5F55"><span class="toc-number">5.</span> <span class="toc-text">文件目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u9012_u5F52_u904D_u5386_u6587_u4EF6_u5939"><span class="toc-number">6.</span> <span class="toc-text">递归遍历文件夹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#FileVisitor"><span class="toc-number">6.1.</span> <span class="toc-text">FileVisitor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FileVisitor_u7684_u5B9E_u73B0"><span class="toc-number">6.2.</span> <span class="toc-text">FileVisitor的实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u4FBF_u5229_u6D41_u7A0B_u7684_u63A7_u5236"><span class="toc-number">6.3.</span> <span class="toc-text">便利流程的控制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u6587_u4EF6_u641C_u7D22"><span class="toc-number">7.</span> <span class="toc-text">文件搜索</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u8DEF_u5F84_u5339_u914D"><span class="toc-number">7.1.</span> <span class="toc-text">路径匹配</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#glob"><span class="toc-number">7.1.1.</span> <span class="toc-text">glob</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#regex"><span class="toc-number">7.1.2.</span> <span class="toc-text">regex</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u4E0Ejava-io-File_u7684_u6BD4_u8F83"><span class="toc-number">8.</span> <span class="toc-text">与java.io.File的比较</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Path_u4E0EFile_u7684_u8F6C_u5316"><span class="toc-number">8.1.</span> <span class="toc-text">Path与File的转化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u53C2_u8003_u8D44_u6599"><span class="toc-number">9.</span> <span class="toc-text">参考资料</span></a></li></ol></div></div><div class="post-content"><p>java.io是面向序列化得字节流，阻塞模式工作，在java.nio中引入很多新的类，它们是面向缓存、非阻塞模式工作，并且类似线程池引入了选择器来管理管道,极大的提升的I/O性能。nio是new i/o，对传统i/o的扩展，但不是替代。</p>
<a id="more"></a>
<h2 id="u8DEF_u5F84_uFF08Path_uFF09"><a href="#u8DEF_u5F84_uFF08Path_uFF09" class="headerlink" title="路径（Path）"></a>路径（Path）</h2><p><a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/Path.html" target="_blank" rel="external">Path</a>是<code>java.nio.file</code>中一个重要的概念。</p>
<h3 id="u4EC0_u4E48_u662F_u8DEF_u5F84"><a href="#u4EC0_u4E48_u662F_u8DEF_u5F84" class="headerlink" title="什么是路径"></a>什么是路径</h3><p>路径在文件系统中用于定位文件。比如：在Mac OS中<code>/Users/Xee/logs/sys.log</code>就表示定位sys.log的路径。在文件操作系统中，文件都是以树或者继承的形态分布。不同的是，在Unix系统下只有一个根root目录，而在Windows下可能会存在多个卷volume。路径的组成包含根目录、根目录到文件路径上的所有中间目录和文件名本身，它们用文件系统中的分隔符连接delimiter。不同的操作系统中分隔符也不一样，Unix中为slash<code>/</code>，如<code>/Users/Xee/logs/sys.log</code>，而在Windows中为black slash<code>\</code>，如<code>C:\home\sally\statusReport</code>。</p>
<h3 id="u8DEF_u5F84_u7C7B_u578B"><a href="#u8DEF_u5F84_u7C7B_u578B" class="headerlink" title="路径类型"></a>路径类型</h3><p>路径分为绝对路径和相对路径。绝对路径包含了根目录以及定位到具体文件所需的所有文件目录。相对目录是相对于某一个文件的路径，需要结合相对的文件才能定位到想定位的问题。</p>
<h3 id="Path_u7684_u4E3B_u8981_u65B9_u6CD5"><a href="#Path_u7684_u4E3B_u8981_u65B9_u6CD5" class="headerlink" title="Path的主要方法"></a><code>Path</code>的主要方法</h3><p>Path包含很多获取有关路径信息的很多方法，包括访问路径中的元素、转化路径格式、匹配路径等。这些方法大部分为静态（static）方法，因为这些操作只是针对路径本身而不需要访问文件系统。</p>
<h4 id="u521B_u5EFA_u8DEF_u5F84"><a href="#u521B_u5EFA_u8DEF_u5F84" class="headerlink" title="创建路径"></a>创建路径</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Path path1 = Paths.get(<span class="string">"/tmp/foo"</span>); <span class="comment">// /tmp/foo</span></span><br><span class="line">Path path2 = Paths.get(System.getProperty(<span class="string">"user.home"</span>), <span class="string">"bar"</span>); <span class="comment">// /Users/Xee/bar</span></span><br><span class="line">Path path3 = Paths.get(URI.create(<span class="string">"file:///Users/Xee/logs/"</span>));  <span class="comment">// /Users/Xee/logs/</span></span><br></pre></td></tr></table></figure>
<p>创建路径可以通过<a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/Paths.html" target="_blank" rel="external">Paths</a>的静态方法，支持通过<code>String</code>和<code>URI</code>来创建。其实它的实现是调用<code>FileSystems</code>：<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Path <span class="title">get</span><span class="params">(String first, String... more)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> FileSystems.getDefault().getPath(first, more);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="u83B7_u53D6_u8DEF_u5F84_u4FE1_u606F"><a href="#u83B7_u53D6_u8DEF_u5F84_u4FE1_u606F" class="headerlink" title="获取路径信息"></a>获取路径信息</h4><p>你可以将Path的存储结构想象成一个存储着路径中所有元素的列表：索引0存储的是根元素，索引n-1存储的是需要定位的文件名，n是路径中所有元素的个数。<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Path path = Paths.get(URI.create(<span class="string">"file:///Users/Xee/logs/"</span>));</span><br><span class="line"></span><br><span class="line">System.out.format(<span class="string">"toString: %s%n"</span>, path.toString());</span><br><span class="line">System.out.format(<span class="string">"getFileName: %s%n"</span>, path.getFileName());</span><br><span class="line">System.out.format(<span class="string">"getName(0): %s%n"</span>, path.getName(<span class="number">0</span>));</span><br><span class="line">System.out.format(<span class="string">"getNameCount: %d%n"</span>, path.getNameCount());</span><br><span class="line">System.out.format(<span class="string">"subpath(0,2): %s%n"</span>, path.subpath(<span class="number">0</span>,<span class="number">2</span>));</span><br><span class="line">System.out.format(<span class="string">"getParent: %s%n"</span>, path.getParent());</span><br><span class="line">System.out.format(<span class="string">"getRoot: %s%n"</span>, path.getRoot());</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Output：</span><br><span class="line">toString: /Users/Xee/logs</span><br><span class="line">getFileName: logs</span><br><span class="line">getName(0): Users</span><br><span class="line">getNameCount: 3</span><br><span class="line">subpath(0,2): Users/Xee</span><br><span class="line">getParent: /Users/Xee</span><br><span class="line">getRoot: /</span><br><span class="line">*/</span></span><br></pre></td></tr></table></figure></p>
<h4 id="u89C4_u683C_u5316_u8DEF_u5F84"><a href="#u89C4_u683C_u5316_u8DEF_u5F84" class="headerlink" title="规格化路径"></a>规格化路径</h4><p><code>normalize()</code>：很多文件系统中用<code>.</code>表示当前文件夹，<code>..</code>表示父级文件夹。</p>
<h4 id="u8DEF_u5F84_u8F6C_u6362"><a href="#u8DEF_u5F84_u8F6C_u6362" class="headerlink" title="路径转换"></a>路径转换</h4><ul>
<li>toUri：转化可以在浏览器中访问的路径</li>
<li>toRealPath：<br><strong> 如果是相对路径，返回绝对路径
</strong> 如果包含<code>.</code>、<code>..</code>等路径，返回规格化的路径</li>
<li>toAbsolutePath：返回绝度路径</li>
<li>normalize：去除被简化的路径信息，返回规格化的路径（<em>但不改变路径类型，原先是相对路径，则还是相对路径</em>）</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// java文件所在路径：/Users/Xee/osceola/</span></span><br><span class="line"><span class="comment">// 创建相对路径</span></span><br><span class="line">Path path = Paths.get(<span class="string">".."</span>);</span><br><span class="line"></span><br><span class="line">System.out.format(<span class="string">"toString: %s%n"</span>, path.toString());</span><br><span class="line"></span><br><span class="line">System.out.format(<span class="string">"toUri: %s%n"</span>, path.toUri());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回真实路径，去除被简化的信息“..”</span></span><br><span class="line">System.out.format(<span class="string">"toRealPath: %s%n"</span>, path.toRealPath(LinkOption.NOFOLLOW_LINKS).toString());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回绝对路径，但包含简化的“..”</span></span><br><span class="line">System.out.format(<span class="string">"toAbsolutePath: %s%n"</span>, path.toAbsolutePath().toString());</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Output:</span><br><span class="line">toString: ..</span><br><span class="line">toUri: file:///Users/Xee/osceola/../</span><br><span class="line">toRealPath: /Users/Xee/</span><br><span class="line">toAbsolutePath: /Users/Xee/osceola/..</span><br><span class="line">*/</span></span><br></pre></td></tr></table></figure>
<h4 id="u89E3_u6790_u76F8_u5BF9_u8DEF_u5F84"><a href="#u89E3_u6790_u76F8_u5BF9_u8DEF_u5F84" class="headerlink" title="解析相对路径"></a>解析相对路径</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Path path = Paths.get(URI.create(<span class="string">"file:///Users/Xee/logs/"</span>));</span><br><span class="line">System.out.format(<span class="string">"toString: %s%n"</span>, path.resolve(<span class="string">".."</span>).toRealPath(NOFOLLOW_LINKS));</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Output:</span><br><span class="line">toString: /Users/Xee</span><br><span class="line">*/</span></span><br></pre></td></tr></table></figure>
<h4 id="u521B_u5EFA_u76F8_u5BF9_u8DEF_u5F84"><a href="#u521B_u5EFA_u76F8_u5BF9_u8DEF_u5F84" class="headerlink" title="创建相对路径"></a>创建相对路径</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Path home = Paths.get(<span class="string">"/Users/Xee"</span>);</span><br><span class="line">Path sysLog = Paths.get(<span class="string">"/Users/Xee/log/sys.log"</span>);</span><br><span class="line"></span><br><span class="line">System.out.format(<span class="string">"home_to_sysLog: %s%n"</span>, home.relativize(sysLog));</span><br><span class="line">System.out.format(<span class="string">"sysLog_to_home: %s%n"</span>, sysLog.relativize(home));</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Output:</span><br><span class="line">home_to_sysLog: log/sys.log</span><br><span class="line">sysLog_to_home: ../..</span><br><span class="line">*/</span></span><br></pre></td></tr></table></figure>
<h4 id="u8DEF_u5F84_u6BD4_u8F83"><a href="#u8DEF_u5F84_u6BD4_u8F83" class="headerlink" title="路径比较"></a>路径比较</h4><p><code>equals</code>，<code>startsWith</code>，<code>endsWith</code>：值得注意的是，这里比较的是<em>存储列表中的元素</em>，而不是真实路径<em>realPath</em>。</p>
<h4 id="u904D_u5386_u8DEF_u5F84_u4E2D_u7684_u5143_u7D20"><a href="#u904D_u5386_u8DEF_u5F84_u4E2D_u7684_u5143_u7D20" class="headerlink" title="遍历路径中的元素"></a>遍历路径中的元素</h4><p>因为Path实现了<code>Iterable</code>接口，所以可以通过迭代器遍历存储结构中的元素。</p>
<h2 id="Files_u57FA_u672C_u64CD_u4F5C"><a href="#Files_u57FA_u672C_u64CD_u4F5C" class="headerlink" title="Files基本操作"></a>Files基本操作</h2><p><a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html" target="_blank" rel="external">Files</a>包含了大量的静态方法，这些方法依赖Path实例。</p>
<p>而实现一般是通过<code>path.getFileSystem().provider()</code>获取<code>FileSystemProvider</code>来执行具体操作。</p>
<h3 id="u68C0_u67E5_u64CD_u4F5C"><a href="#u68C0_u67E5_u64CD_u4F5C" class="headerlink" title="检查操作"></a>检查操作</h3><h4 id="u6587_u4EF6_u5B58_u5728_u6027_u5224_u65AD"><a href="#u6587_u4EF6_u5B58_u5728_u6027_u5224_u65AD" class="headerlink" title="文件存在性判断"></a>文件存在性判断</h4><p><em>注意：</em> </p>
<ul>
<li>文件存在与否可能有三种结果：存在，不存在 或者 未知（没有权限）。</li>
<li>查询结果具有时效性，返回结果表示存在，但当你访问是可能不存在（已被删除）</li>
</ul>
<h4 id="u6587_u4EF6_u8BBF_u95EE_u6743_u9650_u5224_u65AD"><a href="#u6587_u4EF6_u8BBF_u95EE_u6743_u9650_u5224_u65AD" class="headerlink" title="文件访问权限判断"></a>文件访问权限判断</h4><p>可读性、可写性和可执行性。</p>
<h4 id="u8DEF_u5F84_u5B9A_u4F4D_u662F_u5426_u540C_u4E00_u6587_u4EF6"><a href="#u8DEF_u5F84_u5B9A_u4F4D_u662F_u5426_u540C_u4E00_u6587_u4EF6" class="headerlink" title="路径定位是否同一文件"></a>路径定位是否同一文件</h4><p>特别是用于判断软连接定位的文件<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (Files.isSameFile(p1, p2)) &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="u5220_u9664_u3001_u79FB_u52A8_u3001_u590D_u5236"><a href="#u5220_u9664_u3001_u79FB_u52A8_u3001_u590D_u5236" class="headerlink" title="删除、移动、复制"></a>删除、移动、复制</h3><h4 id="u5220_u9664"><a href="#u5220_u9664" class="headerlink" title="删除"></a>删除</h4><p>可以删除文件、目录和链接。</p>
<ul>
<li>如果删除的是链接，链接指向的真正文件是不会被删除的。</li>
<li>如果删除的是目录不为空，则删除失败。</li>
</ul>
<h4 id="u590D_u5236"><a href="#u590D_u5236" class="headerlink" title="复制"></a>复制</h4><p>复制文件时值得注意的是<a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html#copy-java.nio.file.Path-java.nio.file.Path-java.nio.file.CopyOption...-" target="_blank" rel="external">Path copy(Path source, Path target, CopyOption… options)</a>中<em>StandardCopyOption</em>选项：<br>如果目标文件存在，那么复制操作失败，除非指定<code>REPLACE_EXISTING</code>选项进行覆盖。</p>
<p>同时还支持字节流与Path之间的复制。</p>
<p><em>注意</em>：复制目录时，只会复制目录本身而不会递归复制。StandardCopyOption中也没有这个枚举类型。</p>
<h4 id="u79FB_u52A8/_u91CD_u547D_u540D"><a href="#u79FB_u52A8/_u91CD_u547D_u540D" class="headerlink" title="移动/重命名"></a>移动/重命名</h4><p><em>注意</em>：</p>
<ul>
<li>如果是在同个目录下移动，等价于<em>重命名</em></li>
<li>移动目录时，目录里的子文件、子目录也会随着移动（跟复制有差别，复制时不会递归复制）。当然前提是源目录和目标目录在同一个<a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/FileStore.html" target="_blank" rel="external">FileStore</a>中：同一个卷、移动设备等。</li>
</ul>
<h2 id="u6587_u4EF6_u5143_u6570_u636E_uFF08_u6587_u4EF6_u5C5E_u6027_uFF09"><a href="#u6587_u4EF6_u5143_u6570_u636E_uFF08_u6587_u4EF6_u5C5E_u6027_uFF09" class="headerlink" title="文件元数据（文件属性）"></a>文件元数据（文件属性）</h2><p>文件的元数据包含在文件或者目录中，如是不是一个常规文件，还是一个目录或者一个链接。它的大小是多少，创建时间，最后修改时间，文件所属者，所属用户组和访问权限。</p>
<p>一个文件系统的元数据通常指文件的属性。<code>Files</code>中包含了获取以及设置这些属性的方法：<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">+----------------------------------------------+--------------------------------------------------+</span><br><span class="line">| Method                                       | Comment                                          |</span><br><span class="line">+----------------------------------------------+--------------------------------------------------+</span><br><span class="line">| size(Path)                                   | Returns the size of the specified file in bytes. |</span><br><span class="line">+----------------------------------------------+--------------------------------------------------+</span><br><span class="line">| isDirectory(Path, LinkOption)                | Returns true if the file is a directory.         |</span><br><span class="line">+----------------------------------------------+--------------------------------------------------+</span><br><span class="line">| isRegularFile(Path, LinkOption...)           | Returns true if the file is a regular file.      |</span><br><span class="line">+----------------------------------------------+--------------------------------------------------+</span><br><span class="line">| isSymbolicLink(Path)                         | Returns true if the file is a symbolic link.     |</span><br><span class="line">+----------------------------------------------+--------------------------------------------------+</span><br><span class="line">| isHidden(Path)                               | Returns true if the file is considered hidden.   |</span><br><span class="line">+----------------------------------------------+--------------------------------------------------+</span><br><span class="line">| getLastModifiedTime(Path, LinkOption...)     | Returns the specified file's last modified time. |</span><br><span class="line">+----------------------------------------------+--------------------------------------------------+</span><br><span class="line">| getOwner(Path, LinkOption...)                | Returns the owner of the file.                   |</span><br><span class="line">+----------------------------------------------+--------------------------------------------------+</span><br><span class="line">| getPosixFilePermissions(Path, LinkOption...) | Returns a file's POSIX file permissions.         |</span><br><span class="line">+----------------------------------------------+--------------------------------------------------+</span><br><span class="line">| getAttribute(Path, String, LinkOption...)    | Returns the value of a file attribute.           |</span><br><span class="line">+----------------------------------------------+--------------------------------------------------+</span><br></pre></td></tr></table></figure></p>
<p>如果想要一次获取多个属性，Files也是支持的，并且效率大大优于分别取获取单个属性：<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">+----------------------------------------------+------------------------------------------------------------+</span><br><span class="line">| Method                                       | Comment                                                    |</span><br><span class="line">+----------------------------------------------+------------------------------------------------------------+</span><br><span class="line">| readAttributes(Path, String, LinkOption...)  | The String parameter identifies the attributes to be read. |</span><br><span class="line">+----------------------------------------------+------------------------------------------------------------+</span><br><span class="line">|readAttributes(Path, Class<span class="tag">&lt;<span class="title">A</span>&gt;</span>, LinkOption...) | The Class<span class="tag">&lt;<span class="title">A</span>&gt;</span> parameter is the type of attributes requested.|</span><br><span class="line">+----------------------------------------------+------------------------------------------------------------+</span><br></pre></td></tr></table></figure></p>
<h3 id="u57FA_u672C_u6587_u4EF6_u5C5E_u6027"><a href="#u57FA_u672C_u6587_u4EF6_u5C5E_u6027" class="headerlink" title="基本文件属性"></a>基本文件属性</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Path file = Paths.get(System.getProperty(<span class="string">"user.home"</span>));</span><br><span class="line">        </span><br><span class="line">Map&lt;String, Object&gt; attributesMap = Files.readAttributes(file, <span class="string">"*"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (Entry&lt;String, Object&gt; entry : attributesMap.entrySet()) &#123;</span><br><span class="line">    System.out.println(entry.getKey() + <span class="string">" = "</span> + entry.getValue());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Output:</span><br><span class="line">lastAccessTime = 2016-03-12T09:48:48Z</span><br><span class="line">lastModifiedTime = 2016-03-12T09:48:49Z</span><br><span class="line">size = 2686</span><br><span class="line">creationTime = 2015-11-27T02:23:57Z</span><br><span class="line">isSymbolicLink = false</span><br><span class="line">isRegularFile = false</span><br><span class="line">fileKey = (dev=1000004,ino=611925)</span><br><span class="line">isOther = false</span><br><span class="line">isDirectory = true</span><br><span class="line">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="u8BBE_u7F6E_u6587_u4EF6_u65F6_u95F4_u6233"><a href="#u8BBE_u7F6E_u6587_u4EF6_u65F6_u95F4_u6233" class="headerlink" title="设置文件时间戳"></a>设置文件时间戳</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Path file = Paths.get(System.getProperty(<span class="string">"user.home"</span>));</span><br><span class="line"></span><br><span class="line">FileTime currentTime = FileTime.fromMillis(System.currentTimeMillis());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改“最后修改时间”</span></span><br><span class="line">Files.setLastModifiedTime(file, currentTime);</span><br><span class="line"></span><br><span class="line">FileTime lastModifiedTime = (FileTime) Files.getAttribute(file, <span class="string">"lastModifiedTime"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 最后修改时间只能精确到秒</span></span><br><span class="line">assertNotEquals(currentTime.toMillis(), lastModifiedTime.toMillis());</span><br><span class="line">assertEquals(currentTime.to(TimeUnit.SECONDS), lastModifiedTime.to(TimeUnit.SECONDS));</span><br></pre></td></tr></table></figure>
<h3 id="u5176_u4ED6_u5C5E_u6027_u83B7_u53D6"><a href="#u5176_u4ED6_u5C5E_u6027_u83B7_u53D6" class="headerlink" title="其他属性获取"></a>其他属性获取</h3><ul>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/attribute/BasicFileAttributes.html" target="_blank" rel="external">BasicFileAttributes</a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/attribute/DosFileAttributes.html" target="_blank" rel="external">DosFileAttributes</a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/attribute/PosixFileAttributes.html" target="_blank" rel="external">PosixFileAttributes</a></li>
</ul>
<h3 id="u5176_u4ED6_u5C5E_u6027_u8BBE_u7F6E"><a href="#u5176_u4ED6_u5C5E_u6027_u8BBE_u7F6E" class="headerlink" title="其他属性设置"></a>其他属性设置</h3><ul>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/attribute/BasicFileAttributeView.html" target="_blank" rel="external">BasicFileAttributeView</a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/attribute/DosFileAttributeView.html" target="_blank" rel="external">DosFileAttributeView</a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/attribute/PosixFileAttributeView.html" target="_blank" rel="external">PosixFileAttributeView</a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/attribute/AclFileAttributeView.html" target="_blank" rel="external">AclFileAttributeView</a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/attribute/UserDefinedFileAttributeView.html" target="_blank" rel="external">UserDefinedFileAttributeView</a></li>
</ul>
<h2 id="u6587_u4EF6_u7684_u8BFB_u53D6_u3001_u4FEE_u6539_u4E0E_u521B_u5EFA"><a href="#u6587_u4EF6_u7684_u8BFB_u53D6_u3001_u4FEE_u6539_u4E0E_u521B_u5EFA" class="headerlink" title="文件的读取、修改与创建"></a>文件的读取、修改与创建</h2><h3 id="OpenOption_u53C2_u6570"><a href="#OpenOption_u53C2_u6570" class="headerlink" title="OpenOption参数"></a>OpenOption参数</h3><p>OpenOption参数是进行文件内容操作的可选参数，其中<code>StandardOpenOption</code>支持：</p>
<ul>
<li>READ</li>
<li>WRITE</li>
<li>APPEND</li>
<li>TRUNCATE_EXISTING：只有在支持WRITE时生效</li>
<li>CREATE</li>
<li>CREATE_NEW：只有文件不存在时才创建</li>
<li>DELETE_ON_CLOSE：</li>
<li>SPARSE</li>
<li>SYNC：内容及元数据同步</li>
<li>DSYNC：仅仅内容同步</li>
</ul>
<h3 id="u5E38_u7528_u64CD_u4F5C"><a href="#u5E38_u7528_u64CD_u4F5C" class="headerlink" title="常用操作"></a>常用操作</h3><p>主要有<code>readAllBytes</code>、<code>readAllLines</code>、<code>write(Path, byte[])</code>、<code>write(Path, Iterable&lt;? extends CharSequence&gt;</code>，详见下面的demo：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Path path = Paths.get(System.getProperty(<span class="string">"user.home"</span>), <span class="string">"text"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取所有字节数组</span></span><br><span class="line"><span class="keyword">byte</span>[] bytes = Files.readAllBytes(path);</span><br><span class="line">ByteArrayInputStream inputStream = <span class="keyword">new</span> ByteArrayInputStream(bytes);</span><br><span class="line"></span><br><span class="line">Scanner scanner = <span class="keyword">new</span> Scanner(<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inputStream)));</span><br><span class="line"><span class="keyword">while</span> (scanner.hasNextLine()) &#123;</span><br><span class="line">    System.out.println(scanner.nextLine());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取所有行</span></span><br><span class="line">List&lt;String&gt; lines = Files.readAllLines(path);</span><br><span class="line">lines.forEach(System.out::println);</span><br><span class="line">scanner.close();</span><br><span class="line">        </span><br><span class="line"><span class="comment">// 默认的OpenOption：CREATE，TRUNCATE_EXISTING，WRITE</span></span><br><span class="line">Files.write(path, <span class="string">"Hello World"</span>.getBytes());</span><br><span class="line"></span><br><span class="line">Files.write(path, Arrays.asList(<span class="keyword">new</span> String[]&#123;<span class="string">"Hello World"</span>, <span class="string">"Hello NIO"</span>&#125;));</span><br></pre></td></tr></table></figure>
<h3 id="u9762_u5411_u5177_u6709_u7F13_u5B58_u529F_u80FDio_u7684_u64CD_u4F5C"><a href="#u9762_u5411_u5177_u6709_u7F13_u5B58_u529F_u80FDio_u7684_u64CD_u4F5C" class="headerlink" title="面向具有缓存功能io的操作"></a>面向具有缓存功能io的操作</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Path path = Paths.get(System.getProperty(<span class="string">"user.home"</span>), <span class="string">"text"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建BufferedReader</span></span><br><span class="line">BufferedReader reader = Files.newBufferedReader(path);</span><br><span class="line">String line = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">while</span> ((line = reader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">    System.out.println(line);</span><br><span class="line">&#125;</span><br><span class="line">reader.close();</span><br><span class="line"></span><br><span class="line">BufferedWriter write = Files.newBufferedWriter(path);</span><br><span class="line">write.write(<span class="string">"Hello NIO"</span>);</span><br><span class="line">write.close();</span><br></pre></td></tr></table></figure>
<h3 id="u9762_u5411_u4E0D_u5177_u6709_u7F13_u5B58_u529F_u80FDio_u7684_u64CD_u4F5C"><a href="#u9762_u5411_u4E0D_u5177_u6709_u7F13_u5B58_u529F_u80FDio_u7684_u64CD_u4F5C" class="headerlink" title="面向不具有缓存功能io的操作"></a>面向不具有缓存功能io的操作</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Path path = Paths.get(System.getProperty(<span class="string">"user.home"</span>), <span class="string">"text"</span>);</span><br><span class="line"></span><br><span class="line">InputStream inputStream = Files.newInputStream(path);</span><br><span class="line">Scanner scanner = <span class="keyword">new</span> Scanner(<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inputStream)));</span><br><span class="line"><span class="keyword">while</span> (scanner.hasNextLine()) &#123;</span><br><span class="line">    System.out.println(scanner.nextLine());</span><br><span class="line">&#125;</span><br><span class="line">scanner.close();</span><br><span class="line"></span><br><span class="line">OutputStream outputStream = Files.newOutputStream(path);</span><br><span class="line">PrintWriter writer = <span class="keyword">new</span> PrintWriter(<span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(outputStream)));</span><br><span class="line">writer.write(<span class="string">"Hello World"</span>);</span><br><span class="line">writer.close();</span><br></pre></td></tr></table></figure>
<h3 id="u9762_u5411_u7BA1_u9053_u7684_u64CD_u4F5C"><a href="#u9762_u5411_u7BA1_u9053_u7684_u64CD_u4F5C" class="headerlink" title="面向管道的操作"></a>面向管道的操作</h3><p>普通流每次读取一个字符，而管道每次读取一块缓存，这也是NIO与传统IO一个重要的区别。</p>
<h4 id="u8BFB_u53D6_u7F13_u5B58_u5B57_u8282"><a href="#u8BFB_u53D6_u7F13_u5B58_u5B57_u8282" class="headerlink" title="读取缓存字节"></a>读取缓存字节</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Path path = Paths.get(System.getProperty(<span class="string">"user.home"</span>), <span class="string">"text"</span>);</span><br><span class="line"></span><br><span class="line">SeekableByteChannel channel = Files.newByteChannel(path);</span><br><span class="line"></span><br><span class="line">ByteBuffer buffer = ByteBuffer.allocate(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">while</span> (channel.read(buffer) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    buffer.flip();</span><br><span class="line">    System.out.println(Charset.forName(System.getProperty(<span class="string">"file.encoding"</span>)).decode(buffer));</span><br><span class="line">    buf.compact();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">channel.close();</span><br></pre></td></tr></table></figure>
<h4 id="u5199_u5165_u7F13_u5B58_u5B57_u8282"><a href="#u5199_u5165_u7F13_u5B58_u5B57_u8282" class="headerlink" title="写入缓存字节"></a>写入缓存字节</h4><p>管道可以读，也可以写。通过Files创建管道时默认是READ，当需要写操作是需要传入WRITE操作<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Path path = Paths.get(System.getProperty(<span class="string">"user.home"</span>), <span class="string">"text"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置可写操作</span></span><br><span class="line">SeekableByteChannel channel = Files.newByteChannel(path, EnumSet.of(CREATE, WRITE));</span><br><span class="line"></span><br><span class="line">ByteBuffer buffer = ByteBuffer.wrap(<span class="string">"Hello World"</span>.getBytes());</span><br><span class="line">channel.write(buffer);</span><br><span class="line">channel.close();</span><br></pre></td></tr></table></figure></p>
<h3 id="u521B_u5EFA_u6587_u4EF6"><a href="#u521B_u5EFA_u6587_u4EF6" class="headerlink" title="创建文件"></a>创建文件</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Path path = Paths.get(System.getProperty(<span class="string">"user.home"</span>), <span class="string">"text"</span>);</span><br><span class="line">        </span><br><span class="line">Files.createFile(path, asFileAttribute(fromString(<span class="string">"rw-r-----"</span>)));</span><br></pre></td></tr></table></figure>
<h4 id="u521B_u5EFA_u4E34_u65F6_u6587_u4EF6"><a href="#u521B_u5EFA_u4E34_u65F6_u6587_u4EF6" class="headerlink" title="创建临时文件"></a>创建临时文件</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Path file = createTempFile(<span class="keyword">null</span>, <span class="string">".xxy"</span>);</span><br><span class="line">System.out.println(file);</span><br><span class="line"></span><br><span class="line">PosixFileAttributes attrbutes = readAttributes(file, PosixFileAttributes.class);</span><br><span class="line"><span class="comment">// 默认权限为 "rx-------"</span></span><br><span class="line">System.out.println(attrbutes.permissions());</span><br></pre></td></tr></table></figure>
<h2 id="u6587_u4EF6_u76EE_u5F55"><a href="#u6587_u4EF6_u76EE_u5F55" class="headerlink" title="文件目录"></a>文件目录</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 系统根目录</span></span><br><span class="line">FileSystems.getDefault().getRootDirectories().forEach(System.out::println);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建目录或递归创建目录</span></span><br><span class="line">Files.createDirectory(Paths.get(System.getProperty(<span class="string">"user.home"</span>), <span class="string">"tmp"</span>));</span><br><span class="line">Files.createDirectories(Paths.get(System.getProperty(<span class="string">"user.home"</span>), <span class="string">"tmp/a/b/c"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历目录内容</span></span><br><span class="line">Files.newDirectoryStream(Paths.get(System.getProperty(<span class="string">"user.home"</span>))).forEach(System.out::println);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 目录内容过滤，当然你也可以创建自己的过滤器</span></span><br><span class="line">Files.newDirectoryStream(Paths.get(System.getProperty(<span class="string">"user.home"</span>)), <span class="string">".py"</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure>
<h2 id="u9012_u5F52_u904D_u5386_u6587_u4EF6_u5939"><a href="#u9012_u5F52_u904D_u5386_u6587_u4EF6_u5939" class="headerlink" title="递归遍历文件夹"></a>递归遍历文件夹</h2><p>在日常应用中经常需要递归遍历某个文件夹寻找某个文件、或进行访问操作，这时可以使用Files提供的<code>walkFileTree</code>方法，不过你需要实现<code>FileVisitor</code>接口，自定义遍历时的逻辑。</p>
<h3 id="FileVisitor"><a href="#FileVisitor" class="headerlink" title="FileVisitor"></a>FileVisitor</h3><p>FileVisitor接口定义了遍历文件树时的具体行为：访问一个文件时，访问一个目录前，访问一个目录后，以及访问出错时。</p>
<p>访问文件树时可支持自定义深度：<code>walkFileTree(Path, Set&lt;FileVisitOption&gt;, int, FileVisitor)</code></p>
<h3 id="FileVisitor_u7684_u5B9E_u73B0"><a href="#FileVisitor_u7684_u5B9E_u73B0" class="headerlink" title="FileVisitor的实现"></a><code>FileVisitor</code>的实现</h3><p>实现具体的遍历行为时，可以通过继承<code>SimpleFileVisitor</code>，但需要注意：</p>
<ol>
<li>递归删除文件时，那么就需要<em>在删除了目录里内容后，再删除目录本身</em>。</li>
<li>递归创建文件时，顺序则相反</li>
<li>递归修改文件权限时同样需要考虑，因为修改权限后，可能会导致你无法访问。</li>
</ol>
<h3 id="u4FBF_u5229_u6D41_u7A0B_u7684_u63A7_u5236"><a href="#u4FBF_u5229_u6D41_u7A0B_u7684_u63A7_u5236" class="headerlink" title="便利流程的控制"></a>便利流程的控制</h3><p><a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/FileVisitResult.html" target="_blank" rel="external">FileVisitResult</a>是FileVisitor中每个方法的返回值，包括：继续（CONTINUE），终止（TERMINATE），跳过此目录（SKIP_SUBTREE），跳过同级文件或目录（SKIP_SIBLINGS）。</p>
<h2 id="u6587_u4EF6_u641C_u7D22"><a href="#u6587_u4EF6_u641C_u7D22" class="headerlink" title="文件搜索"></a>文件搜索</h2><p>搜索文件可以理解为：递归遍历文件夹，然后一一进行对文件名称匹配。由于在NIO中的核心模型为Path（传统io为File），所以NIO中同样提供了用于路径匹配的<code>PathMatcher</code>：<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PathMatcher</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(Path path)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="u8DEF_u5F84_u5339_u914D"><a href="#u8DEF_u5F84_u5339_u914D" class="headerlink" title="路径匹配"></a>路径匹配</h3><p>PathMatcher可以用过<code>FileSystem</code>的<a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/FileSystem.html#getPathMatcher-java.lang.String-" target="_blank" rel="external">getPathMatcher(String)</a>方法实例化。</p>
<p>创建PathMatcher时的语法为：<code>syntax:pattern</code>。FileSystem支持<a href="http://docs.oracle.com/javase/tutorial/essential/io/fileOps.html#glob" target="_blank" rel="external">glob</a>、<a href="http://docs.oracle.com/javase/tutorial/essential/regex/index.html" target="_blank" rel="external">regex</a>两种语法。</p>
<h4 id="glob"><a href="#glob" class="headerlink" title="glob"></a>glob</h4><ul>
<li><code>*</code>表示匹配0个或多个字符（但没有跨越目录）</li>
<li><code>**</code>表示匹配0个或多个字符（跨目录）</li>
<li><code>?</code>表示匹配0个或1个字符</li>
<li><code>\</code>为转义字符，用来匹配<code>*</code>、<code>?</code>等</li>
<li><p><code>[ ]</code>表示匹配一组字符中的1个字符，比如“[abc]”可以匹配“a”、“b”或者“c”。<br>常常结合<code>-</code>一起使用，表示范围。如“[a-z]”可以匹配从“a”到“z”的所有单个字符。<br>有时也会搭配<code>!</code>来使用表示取反，如[!a-c]表示可以匹配任何字符但除了“a”、“b”、“c”。</p>
<p><em>注意：</em> 方括号中的<code>*</code>，<code>?</code>，<code>\</code>不在具有上述统配意义，将匹配它们本身表示的字符。而<code>-</code>符号为第一字符，也就是不再表示范围时，也表示它本身代表的字符。</p>
</li>
<li><code>{ }</code>表示匹配一组字符串中的任意一个，但不能嵌套使用。<code>,</code>为分隔符。</li>
<li><code>.</code>开头的字符串视为常规的字符，不要理解为正则中的任意字符。</li>
</ul>
<p>比如我们要匹配所有java文件，可以这么来创建：<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">PathMatcher matcher = FileSystems.getDefault().getPathMatcher(<span class="string">"glob:a.java"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一定要使用 getFileName</span></span><br><span class="line"><span class="keyword">if</span> (matcher.matches(file.getFileName())) &#123;</span><br><span class="line">    <span class="comment">// TODO something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>需要注意的是，一定要使用<code>getFileName</code>，因为file一般表示从root到文件中的所有元素。</p>
<h4 id="regex"><a href="#regex" class="headerlink" title="regex"></a>regex</h4><p>参见<a href="http://docs.oracle.com/javase/tutorial/essential/regex/index.html" target="_blank" rel="external">oracle上的教程</a>。</p>
<h2 id="u4E0Ejava-io-File_u7684_u6BD4_u8F83"><a href="#u4E0Ejava-io-File_u7684_u6BD4_u8F83" class="headerlink" title="与java.io.File的比较"></a>与<code>java.io.File</code>的比较</h2><p>JDK7发布前File是主要的I/O类，但它具有很多缺点：</p>
<ul>
<li>很多方法失败时不会抛出明确异常。比如文件删除失败时，你无法得知是文件不存在还是没有权限。</li>
<li>不能友好的支持文件连接。</li>
<li>不能全面的支持文件元数据，如Ownner，permission等。</li>
<li>不能友好的支持递归遍历目录。</li>
</ul>
<h3 id="Path_u4E0EFile_u7684_u8F6C_u5316"><a href="#Path_u4E0EFile_u7684_u8F6C_u5316" class="headerlink" title="Path与File的转化"></a>Path与File的转化</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Path input = file.toPath();</span><br><span class="line">Files.delete(fp);</span><br></pre></td></tr></table></figure>
<p>其他场景的转化参见：<a href="http://docs.oracle.com/javase/tutorial/essential/io/legacy.html#mapping" target="_blank" rel="external">官方文档</a></p>
<h2 id="u53C2_u8003_u8D44_u6599"><a href="#u53C2_u8003_u8D44_u6599" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="http://tutorials.jenkov.com/java-nio/index.html" target="_blank" rel="external">http://tutorials.jenkov.com/java-nio/index.html</a></li>
</ul>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://www.xiaoyuxee.com/2016/03/11/nio-in-java/" data-id="cils7a25m0008qum5zxux6a4e" class="article-share-link">分享到</a><div class="tags"><a href="/tags/NIO/">NIO</a></div><div class="post-nav"><a href="/2016/03/13/in-depth-understanding-of-channel-in-nio/" class="pre">深入理解nio中的Channel</a><a href="/2016/02/15/basic-IO-in-java/" class="next">Java中的输入/输出流</a></div><div id="disqus_thread"><script>var disqus_shortname = 'xiaoyuxee';
var disqus_identifier = '2016/03/11/nio-in-java/';
var disqus_title = 'Java中的NIO';
var disqus_url = 'http://www.xiaoyuxee.com/2016/03/11/nio-in-java/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//xiaoyuxee.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://www.xiaoyuxee.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java-Core/">Java-Core</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/">Spring</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/生活随笔/">生活随笔</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/目标管理/">目标管理</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Eclipse/" style="font-size: 15px;">Eclipse</a> <a href="/tags/NIO/" style="font-size: 15px;">NIO</a> <a href="/tags/Lambda/" style="font-size: 15px;">Lambda</a> <a href="/tags/Java8/" style="font-size: 15px;">Java8</a> <a href="/tags/Channel/" style="font-size: 15px;">Channel</a> <a href="/tags/JDBC/" style="font-size: 15px;">JDBC</a> <a href="/tags/Srping-MVC/" style="font-size: 15px;">Srping-MVC</a> <a href="/tags/Concurrence/" style="font-size: 15px;">Concurrence</a> <a href="/tags/Thread/" style="font-size: 15px;">Thread</a> <a href="/tags/Wiring-Beans/" style="font-size: 15px;">Wiring-Beans</a> <a href="/tags/IO/" style="font-size: 15px;">IO</a> <a href="/tags/Aggregate-Operation/" style="font-size: 15px;">Aggregate-Operation</a> <a href="/tags/Stream/" style="font-size: 15px;">Stream</a> <a href="/tags/个人计划/" style="font-size: 15px;">个人计划</a> <a href="/tags/Synchronization/" style="font-size: 15px;">Synchronization</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/03/15/concurrence-in-java-2/">Java中的多线程（二）：同步机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/15/concurrence-in-java-1/">Java中的多线程（一）：线程的基本概念和使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/13/in-depth-understanding-of-channel-in-nio/">深入理解nio中的Channel</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/11/nio-in-java/">Java中的NIO</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/15/basic-IO-in-java/">Java中的输入/输出流</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/06/aggregate-operation-in-java8/">Java8中的Stream</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/05/lambda-in-java8/">Java8中的Lambda表达式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/30/wiring-beans-in-spring/">Wiring Beans In Spring</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/24/database-access-in-java/">Java应用中的数据库访问</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/17/coding-effectively-with-eclipse-on-mac/">Mac下高效地使用Eclipse</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//xiaoyuxee.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">子善.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/jquery.min.js?v=0.0.0"></script><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-34320961-1','auto');ga('send','pageview');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?df8e4e2f63affab3a847f75bd4b5f732";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>